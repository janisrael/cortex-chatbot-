<!-- LLM Configuration Tab -->
<div id="llm-tab" class="tab-content">
    <div class="card">
        <h2><span class="material-icons-round" style="vertical-align: middle; font-size: 24px;">settings</span> LLM Configuration</h2>
        
        <div class="alert alert-success" id="llmSuccess"></div>
        <div class="alert alert-error" id="llmError"></div>

        <!-- LLM Status & Testing Section (Top) -->
        <div class="config-section">
            <div class="llm-status-test-grid">
                <!-- Column 1: Active LLM Status -->
                <div class="llm-status-card">
                    <div class="llm-status-header">
                        <h3 class="section-title">Active LLM</h3>
                    </div>
                    <div class="llm-status-content" id="activeLLMStatus">
                        <div class="llm-status-icon-wrapper">
                            <img id="activeLLMLogo" src="" alt="" style="display: none; width: 100%; height: 100%; object-fit: contain;">
                            <span class="material-icons-round llm-provider-icon" id="activeLLMIcon">smart_toy</span>
                        </div>
                        <div class="llm-status-info">
                            <div class="llm-provider-name" id="activeLLMProvider">OpenAI</div>
                            <div class="llm-model-name" id="activeLLMModel">gpt-4o-mini</div>
                        </div>
                        <div class="llm-status-indicator">
                            <span class="status-dot active" id="llmStatusDot" style="background-color: rgb(40, 167, 69);"></span>
                        </div>
                    </div>
                </div>

                <!-- Column 2: Test Configuration -->
                <div class="llm-test-card">
                    <div class="llm-test-header">
                        <h3 class="section-title">Test Configuration</h3>
                    </div>
                    <div class="llm-test-content">
                        <button class="btn btn-success" onclick="testLLM()" id="testLLMBtn" style="width: 100%;">
                            <span class="material-icons-round" style="vertical-align: middle; font-size: 18px;">science</span> Test Current Configuration
                        </button>
                        <div class="loading" id="llmLoading" style="display: none;">
                            <div class="spinner"></div>
                            Processing LLM request...
                        </div>
                        <div class="test-response" id="testResponse"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Website Selector - HIDDEN (v2 uses user-based system, not website-based) -->
        <!-- <div class="website-selector-section" style="display: none;">
            <label class="section-label">Configure LLM for Website</label>
            <div class="website-tabs" id="websiteTabs">
            </div>
        </div> -->

        <!-- LLM Provider Selection -->
        <div class="config-section">
            <h3 class="section-title">LLM Provider & Model</h3>
            <p class="section-description">Choose which AI provider and model your chatbot will use. You can use your own API key or the system default.</p>

            <!-- Provider Info Box -->
            <div id="providerInfoBox" class="provider-info-box" style="display: none;">
                <div class="provider-info-header">
                    <span class="material-icons-round" style="font-size: 20px; margin-right: 8px;">info</span>
                    <strong id="providerInfoName">Provider Information</strong>
                </div>
                <div id="providerInfoDescription" class="provider-info-description"></div>
                <div id="providerInfoStrengths" class="provider-info-strengths"></div>
            </div>

            <div class="config-row">
                <div class="form-group">
                    <label for="llmProvider">Provider</label>
                    <select id="llmProvider" class="form-control" onchange="onProviderChange()">
                        <!-- Options will be populated dynamically by JavaScript with free tier labels -->
                        <option value="openai">OpenAI (Default)</option>
                    </select>
                    <small style="color: #71717a; font-size: 12px;">Select your preferred AI provider</small>
                </div>
                <div class="form-group">
                    <label for="llmModel">Model</label>
                    <select id="llmModel" class="form-control">
                        <!-- Models will be populated dynamically based on provider -->
                    </select>
                    <small style="color: #71717a; font-size: 12px;">Select the specific model</small>
                </div>
            </div>

            <div class="form-group">
                <label for="llmApiKey">API Key</label>
                <div class="input-with-clear">
                    <input type="password" id="llmApiKey" class="form-control" 
                           placeholder="Leave empty to use system default API key">
                    <button type="button" class="input-clear-btn" id="llmApiKeyClear" onclick="clearApiKeyInput()" style="display: none;">
                        <span class="material-icons-round">close</span>
                    </button>
                </div>
                <small style="color: #71717a; font-size: 12px;">Provide your own API key for the selected provider, or leave empty to use the system default</small>
            </div>

            <div class="config-actions">
                <button class="btn" onclick="saveLLMProviderConfig()" id="saveLLMProviderBtn">
                    <span class="material-icons-round" style="vertical-align: middle; font-size: 18px;">save</span> Save Provider Settings
                </button>
                <button class="btn btn-secondary" onclick="if(typeof testLLMProvider==='function'){testLLMProvider();}else{console.error('testLLMProvider not found');alert('Test function not loaded. Please refresh the page.');}" id="testLLMProviderBtn">
                    <span class="material-icons-round" style="vertical-align: middle; font-size: 18px;">science</span> Test Connection
                </button>
            </div>
        </div>

        <!-- Advanced Chatbot Settings -->
        <div class="config-section">
            <h3 class="section-title">Advanced Chatbot Settings</h3>
            <p class="section-description">Fine-tune how your chatbot responds. These settings directly affect chatbot behavior.</p>

            <div class="config-row">
                <div class="form-group">
                    <label for="chatbotTemperature" style="display: flex; align-items: center; gap: 6px;">
                        Temperature
                        <span class="material-icons-round info-icon" 
                              style="font-size: 18px; color: #64748b; cursor: pointer;"
                              onclick="showInfoTooltip(event, 'Controls how creative or focused the AI responses are. Lower values (0.0-0.5) make responses more focused and deterministic. Higher values (1.0-2.0) make responses more creative and varied. Recommended: 0.3 for balanced responses, 0.7-1.0 for creative content.')">info</span>
                    </label>
                    <input type="number" id="chatbotTemperature" class="form-control" 
                           min="0" max="2" step="0.1" value="0.3">
                    <small style="color: #71717a; font-size: 12px;">Controls creativity (0.0 = focused, 2.0 = creative)</small>
                </div>
                <div class="form-group">
                    <label for="chatbotMaxTokens" style="display: flex; align-items: center; gap: 6px;">
                        Max Tokens
                        <span class="material-icons-round info-icon" 
                              style="font-size: 18px; color: #64748b; cursor: pointer;"
                              onclick="showInfoTooltip(event, 'Sets the maximum length of the AI\'s response. Lower values (50-500) create shorter, concise answers. Higher values (2000-4000) allow for longer, detailed responses. This directly affects response length and API costs.')">info</span>
                    </label>
                    <input type="number" id="chatbotMaxTokens" class="form-control" 
                           min="50" max="4000" step="50" value="2000">
                    <small style="color: #71717a; font-size: 12px;">Maximum response length</small>
                </div>
            </div>

            <div class="config-row">
                <div class="form-group">
                    <label for="chatbotTopP" style="display: flex; align-items: center; gap: 6px;">
                        Top P (Nucleus Sampling)
                        <span class="material-icons-round info-icon" 
                              style="font-size: 18px; color: #64748b; cursor: pointer;"
                              onclick="showInfoTooltip(event, 'Controls response diversity by limiting token selection to the top probability mass. Lower values (0.1-0.5) make responses more focused and predictable. Higher values (0.9-1.0) allow more diverse word choices. Works together with Temperature to fine-tune response style.')">info</span>
                    </label>
                    <input type="number" id="chatbotTopP" class="form-control" 
                           min="0" max="1" step="0.1" value="1.0">
                    <small style="color: #71717a; font-size: 12px;">Controls diversity (0.0-1.0)</small>
                </div>
                <div class="form-group">
                    <label for="chatbotResponseStyle" style="display: flex; align-items: center; gap: 6px;">
                        Response Style
                        <span class="material-icons-round info-icon" 
                              style="font-size: 18px; color: #64748b; cursor: pointer;"
                              onclick="showInfoTooltip(event, 'Sets the overall tone and length of AI responses. Concise: Short, direct answers. Balanced: Moderate length with good detail (recommended). Detailed: Longer, comprehensive responses. Creative: More varied and expressive language. This affects how the AI structures and presents information.')">info</span>
                    </label>
                    <select id="chatbotResponseStyle" class="form-control">
                        <option value="concise">Concise</option>
                        <option value="balanced" selected>Balanced</option>
                        <option value="detailed">Detailed</option>
                        <option value="creative">Creative</option>
                    </select>
                    <small style="color: #71717a; font-size: 12px;">Overall response style</small>
                </div>
            </div>

            <div class="config-row">
                <div class="form-group">
                    <label for="chatbotFrequencyPenalty" style="display: flex; align-items: center; gap: 6px;">
                        Frequency Penalty
                        <span class="material-icons-round info-icon" 
                              style="font-size: 18px; color: #64748b; cursor: pointer;"
                              onclick="showInfoTooltip(event, 'Reduces the likelihood of the AI repeating the same words or phrases. Positive values (0.1-2.0) penalize frequent tokens, making responses more varied. Negative values (-2.0 to -0.1) encourage repetition. Use 0.5-1.0 to reduce repetitive answers, especially in longer conversations.')">info</span>
                    </label>
                    <input type="number" id="chatbotFrequencyPenalty" class="form-control" 
                           min="-2" max="2" step="0.1" value="0.0">
                    <small style="color: #71717a; font-size: 12px;">Reduces repetition (-2.0 to 2.0)</small>
                </div>
                <div class="form-group">
                    <label for="chatbotPresencePenalty" style="display: flex; align-items: center; gap: 6px;">
                        Presence Penalty
                        <span class="material-icons-round info-icon" 
                              style="font-size: 18px; color: #64748b; cursor: pointer;"
                              onclick="showInfoTooltip(event, 'Encourages the AI to talk about new topics and avoid staying on the same subject. Positive values (0.1-2.0) reward new tokens, making the AI explore different topics. Negative values (-2.0 to -0.1) keep the AI focused on current topics. Use 0.5-1.0 to encourage diverse topic coverage in conversations.')">info</span>
                    </label>
                    <input type="number" id="chatbotPresencePenalty" class="form-control" 
                           min="-2" max="2" step="0.1" value="0.0">
                    <small style="color: #71717a; font-size: 12px;">Encourages new topics (-2.0 to 2.0)</small>
                </div>
            </div>

            <div class="form-group">
                <label for="chatbotSystemInstructions" style="display: flex; align-items: center; gap: 6px;">
                    System Instructions (Optional)
                    <span class="material-icons-round info-icon" 
                          style="font-size: 18px; color: #64748b; cursor: pointer;"
                          onclick="showInfoTooltip(event, 'Provides additional context and behavior guidelines for the AI chatbot. Use this to customize how the AI responds, its tone, style, or specific knowledge areas to focus on. Examples: Always be friendly and professional, Focus on technical details, Answer in simple language, Refer to company policies when relevant. This helps shape the AI\'s personality and response style.')">info</span>
                </label>
                <textarea id="chatbotSystemInstructions" class="form-control" rows="3" 
                          placeholder="Additional context or instructions for your chatbot (e.g., 'Always be professional', 'Use technical terms when appropriate')"></textarea>
                <small style="color: #71717a; font-size: 12px;">Additional instructions that guide chatbot behavior</small>
            </div>

            <div class="config-actions">
                <button class="btn" onclick="saveAdvancedSettings()" id="saveAdvancedBtn">
                    <span class="material-icons-round" style="vertical-align: middle; font-size: 18px;">save</span> Save Advanced Settings
                </button>
                <button class="btn btn-secondary" onclick="resetAdvancedSettings()" id="resetAdvancedBtn">
                    <span class="material-icons-round" style="vertical-align: middle; font-size: 18px;">refresh</span> Reset to Defaults
                </button>
            </div>
        </div>

    </div>
</div>

<!-- Info Tooltip Modal -->
<div id="infoTooltipModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.5); z-index: 10000; align-items: center; justify-content: center;">
    <div style="background: white; border-radius: 12px; padding: 24px; max-width: 500px; width: 90%; box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15); position: relative;">
        <button onclick="closeInfoTooltip()" style="position: absolute; top: 12px; right: 12px; background: none; border: none; cursor: pointer; color: #64748b; padding: 4px; display: flex; align-items: center; justify-content: center;">
            <span class="material-icons-round" style="font-size: 24px;">close</span>
        </button>
        <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 16px;">
            <span class="material-icons-round" style="font-size: 28px; color: #0891b2;">info</span>
            <h3 style="margin: 0; font-size: 20px; font-weight: 600; color: #1e293b;">Setting Information</h3>
        </div>
        <p id="infoTooltipContent" style="color: #475569; font-size: 14px; line-height: 1.6; margin: 0;"></p>
    </div>
</div>

<script>
function showInfoTooltip(event, content) {
    event.stopPropagation();
    const modal = document.getElementById('infoTooltipModal');
    const contentEl = document.getElementById('infoTooltipContent');
    if (modal && contentEl) {
        contentEl.textContent = content;
        modal.style.display = 'flex';
    }
}

function closeInfoTooltip() {
    const modal = document.getElementById('infoTooltipModal');
    if (modal) {
        modal.style.display = 'none';
    }
}

// Close modal when clicking outside
document.addEventListener('click', function(event) {
    const modal = document.getElementById('infoTooltipModal');
    if (modal && event.target === modal) {
        closeInfoTooltip();
    }
});

// Close modal on Escape key
document.addEventListener('keydown', function(event) {
    if (event.key === 'Escape') {
        closeInfoTooltip();
    }
});
</script>

