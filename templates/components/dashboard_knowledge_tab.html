<!-- Knowledge Management Tab -->
<div id="knowledge-tab" class="tab-content">
    <!-- Knowledge Stats Cards (3 columns) -->
    <div class="knowledge-stats-grid" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-bottom: 30px;">
        <!-- Uploaded Files Card -->
        <div class="metric-card" style="background: white; border: 2px solid #e1e5e9; border-radius: 12px; padding: 20px; transition: all 0.3s ease;">
            <div style="display: flex; align-items: center; gap: 15px;">
                <div class="metric-icon" style="width: 56px; height: 56px; background: linear-gradient(135deg, #0891b2 0%, #0f766e 100%); border-radius: 12px; display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
                    <span class="material-icons-round" style="font-size: 28px; color: white;">cloud_upload</span>
                </div>
                <div style="flex: 1; min-width: 0;">
                    <div style="font-size: 14px; color: #64748b; font-weight: 500; margin-bottom: 4px;">Uploaded Files</div>
                    <div style="font-size: 24px; font-weight: 700; color: #1e293b;" id="knowledgeFilesCount">-</div>
                    <div style="font-size: 12px; color: #94a3b8; margin-top: 4px;" id="knowledgeFilesLimit">Limit: 100</div>
                </div>
            </div>
        </div>

        <!-- Crawled Websites Card -->
        <div class="metric-card" style="background: white; border: 2px solid #e1e5e9; border-radius: 12px; padding: 20px; transition: all 0.3s ease;">
            <div style="display: flex; align-items: center; gap: 15px;">
                <div class="metric-icon" style="width: 56px; height: 56px; background: linear-gradient(135deg, #0891b2 0%, #0f766e 100%); border-radius: 12px; display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
                    <span class="material-icons-round" style="font-size: 28px; color: white;">language</span>
                </div>
                <div style="flex: 1; min-width: 0;">
                    <div style="font-size: 14px; color: #64748b; font-weight: 500; margin-bottom: 4px;">Crawled Websites</div>
                    <div style="font-size: 24px; font-weight: 700; color: #1e293b;" id="knowledgeCrawledCount">-</div>
                    <div style="font-size: 12px; color: #94a3b8; margin-top: 4px;" id="knowledgeCrawledLimit">Limit: 200 websites</div>
                </div>
            </div>
        </div>

        <!-- FAQ Entries Card -->
        <div class="metric-card" style="background: white; border: 2px solid #e1e5e9; border-radius: 12px; padding: 20px; transition: all 0.3s ease;">
            <div style="display: flex; align-items: center; gap: 15px;">
                <div class="metric-icon" style="width: 56px; height: 56px; background: linear-gradient(135deg, #0891b2 0%, #0f766e 100%); border-radius: 12px; display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
                    <span class="material-icons-round" style="font-size: 28px; color: white;">help_center</span>
                </div>
                <div style="flex: 1; min-width: 0;">
                    <div style="font-size: 14px; color: #64748b; font-weight: 500; margin-bottom: 4px;">FAQ Entries</div>
                    <div style="font-size: 24px; font-weight: 700; color: #1e293b;" id="knowledgeFaqCount">-</div>
                    <div style="font-size: 12px; color: #94a3b8; margin-top: 4px;" id="knowledgeFaqLimit">Limit: 500 FAQs</div>
                </div>
            </div>
        </div>
    </div>

    <!-- File Upload Section (100% width) -->
    <div class="card" style="width: 100%; margin-bottom: 30px;">
        <h2><span class="material-icons-round" style="vertical-align: middle; font-size: 24px;">upload_file</span> Upload Documents</h2>
        
        <div class="alert alert-success" id="uploadSuccess"></div>
        <div class="alert alert-error" id="uploadError"></div>

        <!-- Category Selection (4 columns) -->
        <div class="form-group" style="margin-bottom: 25px;">
            <label style="display: block; margin-bottom: 12px; font-weight: 600; color: #1e293b;">Document Category</label>
            <div class="category-tabs" id="categoryTabs">
                <!-- Dynamically populated -->
            </div>
        </div>
        
        <!-- AI Cleaning & Upload Area (2 columns - left smaller, right larger) -->
        <div class="upload-controls-grid" style="display: grid; grid-template-columns: 0.4fr 1fr; gap: 20px; margin-bottom: 20px;">
            <!-- Left Column: AI Cleaning Checkbox (smaller width) -->
            <div style="display: flex; flex-direction: column; justify-content: center; padding: 20px; background: #f8f9fa; border-radius: 10px; border: 2px solid #e1e5e9;">
                <div style="display: flex; align-items: flex-start; gap: 12px; margin-bottom: 10px;">
                    <input type="checkbox" id="fileAiCleaningEnabled" checked style="width: 24px; height: 24px; cursor: pointer; flex-shrink: 0; margin-top: 2px; accent-color: #0891b2;">
                    <label for="fileAiCleaningEnabled" style="color: #1e293b; cursor: pointer; font-size: 15px; font-weight: 600; margin: 0; line-height: 1.4;">
                        Enable AI Content Cleaning
                    </label>
                </div>
                <p style="margin: 0; color: #64748b; font-size: 12px; line-height: 1.5; padding-left: 36px;">
                    Removes navigation, footers, SEO metadata. Cleaner documents = better embeddings = better search results.
                </p>
            </div>
            
            <!-- Right Column: File Upload Area (larger width) -->
            <div class="file-upload" id="fileUpload" style="display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 140px;">
                <span class="material-icons-round upload-icon" style="font-size: 48px; color: #0891b2; margin-bottom: 10px;">folder</span>
                <p style="margin: 5px 0; font-weight: 600; color: #1e293b;"><strong>Drop files here or click to browse</strong></p>
                <p style="margin: 5px 0; color: #64748b; font-size: 13px;">Supported: PDF, TXT, DOC, DOCX, CSV (Max 16MB)</p>
                <input type="file" id="fileInput" multiple accept=".pdf,.txt,.doc,.docx,.csv">
            </div>
        </div>
        
        <div class="loading" id="uploadLoading">
            <div class="spinner"></div>
            Processing file...
        </div>

            <!-- Uploaded Files (inside the same card) -->
            <div style="margin-top: 30px; padding-top: 20px; border-top: 1px solid #333;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                    <h3 style="margin: 0; font-size: 18px;">
                        <span class="material-icons-round" style="vertical-align: middle; font-size: 20px;">folder_open</span> 
                        Uploaded Files
                    </h3>
                    <button class="btn btn-secondary" onclick="refreshFileList()" style="padding: 6px 12px; font-size: 12px;">
                        <span class="material-icons-round" style="vertical-align: middle; font-size: 16px;">refresh</span> Refresh
                    </button>
                </div>
                <div class="file-list" id="fileList">
                    Loading files...
                </div>
            </div>
        </div>

    <!-- URL Crawling Section (100% width) -->
    <div class="card" style="width: 100%; margin-bottom: 30px;">
        <h2><span class="material-icons-round" style="vertical-align: middle; font-size: 24px;">language</span> Crawl Websites</h2>
        
        <div class="alert alert-success" id="crawlSuccess"></div>
        <div class="alert alert-error" id="crawlError"></div>
        
        <!-- 3 Column Layout: AI Cleaning, Recrawl, Upload Sitemap -->
        <div class="crawl-options-grid" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-bottom: 25px;">
            <!-- First Column: Enable AI Content Cleaning -->
            <div style="display: flex; flex-direction: column; justify-content: center; padding: 20px; background: #f8f9fa; border-radius: 10px; border: 2px solid #e1e5e9;">
                <div style="display: flex; align-items: flex-start; gap: 12px; margin-bottom: 10px;">
                    <input type="checkbox" id="aiCleaningEnabled" checked style="width: 24px; height: 24px; cursor: pointer; flex-shrink: 0; margin-top: 2px; accent-color: #0891b2;">
                    <label for="aiCleaningEnabled" style="color: #1e293b; cursor: pointer; font-size: 15px; font-weight: 600; margin: 0; line-height: 1.4;">
                        Enable AI Content Cleaning
                    </label>
                </div>
                <p style="margin: 0; color: #64748b; font-size: 12px; line-height: 1.5; padding-left: 36px;">
                    Removes navigation, footers, SEO metadata. Cleaner content = better embeddings = better search results.
                </p>
            </div>
            
            <!-- Second Column: Recrawl Button -->
            <div style="display: flex; flex-direction: column; justify-content: center; padding: 20px; background: #f8f9fa; border-radius: 10px; border: 2px solid #e1e5e9; position: relative;">
                <div style="position: absolute; top: 8px; right: 8px;">
                    <span style="background: #f59e0b; color: white; font-size: 10px; padding: 2px 6px; border-radius: 10px; font-weight: 600;">Future Feature</span>
                </div>
                <button class="btn btn-secondary" onclick="showRecrawlConfirm()" style="width: 100%; padding: 12px; font-weight: 600; margin-bottom: 10px; display: flex; align-items: center; justify-content: center; gap: 8px;">
                    <span class="material-icons-round" style="font-size: 18px;">refresh</span>
                    <span>Recrawl</span>
                </button>
                <p style="margin: 0; color: #64748b; font-size: 12px; line-height: 1.5;">
                    Recrawl all websites on the list to update content. This will replace existing crawled data.
                </p>
            </div>
            
            <!-- Third Column: Upload Sitemap Button -->
            <div style="display: flex; flex-direction: column; justify-content: center; padding: 20px; background: #f8f9fa; border-radius: 10px; border: 2px solid #e1e5e9; position: relative;">
                <div style="position: absolute; top: 8px; right: 8px;">
                    <span style="background: #f59e0b; color: white; font-size: 10px; padding: 2px 6px; border-radius: 10px; font-weight: 600;">Future Feature</span>
                </div>
                <button class="btn btn-secondary" onclick="showUploadSitemapInfo()" style="width: 100%; padding: 12px; font-weight: 600; margin-bottom: 10px; display: flex; align-items: center; justify-content: center; gap: 8px;">
                    <span class="material-icons-round" style="font-size: 18px;">upload_file</span>
                    <span>Upload Sitemap</span>
                </button>
                <p style="margin: 0; color: #64748b; font-size: 12px; line-height: 1.5;">
                    Upload a sitemap file to crawl multiple URLs automatically from your website.
                </p>
            </div>
        </div>
        
        <!-- URL Input & Crawl Button -->
        <div style="margin-bottom: 20px;">
            <label for="urlInput" style="display: block; margin-bottom: 8px; font-weight: 600; color: #1e293b; font-size: 14px;">Website URL</label>
            <div style="display: flex; gap: 12px; align-items: center;">
                <input type="url" id="urlInput" class="form-control" placeholder="https://example.com" style="flex: 1; padding: 12px; border: 2px solid #e1e5e9; border-radius: 8px; font-size: 14px;">
                <button class="btn" onclick="crawlUrl()" id="crawlBtn" style="padding: 12px 24px; font-weight: 600; white-space: nowrap;">
                    <span class="material-icons-round" style="vertical-align: middle; font-size: 18px;">search</span> Crawl
                </button>
            </div>
            <p style="margin: 8px 0 0 0; color: #64748b; font-size: 12px; line-height: 1.5;">
                Enter a single URL to crawl. The system will extract and clean the content from that page.
            </p>
        </div>

        <div class="loading" id="crawlLoading">
            <div class="spinner"></div>
            Crawling website...
        </div>

            <!-- Crawled URLs (inside the same card) -->
            <div style="margin-top: 30px; padding-top: 20px; border-top: 1px solid #e1e5e9;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                    <h3 style="margin: 0; font-size: 18px;">
                        <span class="material-icons-round" style="vertical-align: middle; font-size: 20px;">language</span> 
                        Crawled Websites
                    </h3>
                    <button class="btn btn-secondary" onclick="refreshCrawledUrls()" style="padding: 6px 12px; font-size: 12px;">
                        <span class="material-icons-round" style="vertical-align: middle; font-size: 16px;">refresh</span> Refresh
                    </button>
                </div>
                <div class="crawled-urls-list" id="crawledUrlsList">
                    Loading crawled URLs...
                </div>
            </div>
        </div>

    <!-- FAQ Management Section (100% width) -->
    <div class="card" style="width: 100%; margin-bottom: 30px;">
        <h2><span class="material-icons-round" style="vertical-align: middle; font-size: 24px;">help_center</span> FAQ Management</h2>
        
        <div class="alert alert-success" id="faqSuccess" style="display: none;"></div>
        <div class="alert alert-error" id="faqError" style="display: none;"></div>

        <!-- Category Selection (4 columns) -->
        <div class="form-group" style="margin-bottom: 25px;">
            <label style="display: block; margin-bottom: 12px; font-weight: 600; color: #1e293b;">FAQ Category</label>
            <div class="category-tabs" id="faqCategoryTabs">
                <!-- Dynamically populated -->
            </div>
        </div>

        <!-- Add FAQ Form -->
        <div class="form-group" style="margin-bottom: 20px;">
            <label for="faqQuestion" style="display: block; margin-bottom: 8px; font-weight: 600; color: #1e293b;">Question</label>
            <input type="text" id="faqQuestion" class="form-control" placeholder="e.g., What is your return policy?" style="margin-bottom: 12px;">
            
            <label for="faqAnswer" style="display: block; margin-bottom: 8px; font-weight: 600; color: #1e293b;">Answer</label>
            <textarea id="faqAnswer" class="form-control" rows="4" placeholder="e.g., We offer a 30-day return policy for all products..." style="margin-bottom: 12px; resize: vertical;"></textarea>
            
            <button class="btn" onclick="createFAQ()" id="createFaqBtn" style="width: 100%;">
                <span class="material-icons-round" style="vertical-align: middle; font-size: 18px;">add</span> Add FAQ
            </button>
        </div>

        <!-- FAQ List -->
        <div style="margin-top: 30px; padding-top: 20px; border-top: 1px solid #e1e5e9;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                    <h3 style="margin: 0; font-size: 18px;">
                        <span class="material-icons-round" style="vertical-align: middle; font-size: 20px;">help_center</span> 
                        FAQ Entries
                    </h3>
                    <button class="btn btn-secondary" onclick="refreshFAQList()" style="padding: 6px 12px; font-size: 12px;">
                        <span class="material-icons-round" style="vertical-align: middle; font-size: 16px;">refresh</span> Refresh
                    </button>
                </div>
                <div id="faqList">
                    Loading FAQs...
                </div>
            </div>
        </div>
</div>

<!-- FAQ Edit Modal -->
<div id="faqEditModal" class="modal" style="display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5); overflow: auto;">
    <div class="modal-content" style="background-color: #1e1e1e; margin: 5% auto; padding: 20px; border: 1px solid #333; border-radius: 8px; max-width: 700px; max-height: 90vh; overflow-y: auto;">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
            <h2 style="margin: 0; color: white;">Edit FAQ</h2>
            <button onclick="closeFAQEditModal()" style="background: none; border: none; color: white; font-size: 28px; cursor: pointer; padding: 0; width: 32px; height: 32px; display: flex; align-items: center; justify-content: center;">&times;</button>
        </div>
        
        <div class="form-group">
            <label for="editFaqQuestion" style="color: white; display: block; margin-bottom: 8px;">Question</label>
            <input type="text" id="editFaqQuestion" class="form-control" style="margin-bottom: 15px;">
            
            <label for="editFaqAnswer" style="color: white; display: block; margin-bottom: 8px;">Answer</label>
            <textarea id="editFaqAnswer" class="form-control" rows="6" style="margin-bottom: 15px; resize: vertical;"></textarea>
            
            <label for="editFaqCategory" style="color: white; display: block; margin-bottom: 8px;">Category</label>
            <select id="editFaqCategory" class="form-control" style="margin-bottom: 20px;">
                <option value="company_details">Company Details</option>
                <option value="products_services">Products & Services</option>
                <option value="support">Support</option>
                <option value="pricing">Pricing</option>
                <option value="other">Other</option>
            </select>
        </div>
        
        <div style="display: flex; gap: 12px; justify-content: flex-end;">
            <button class="btn btn-secondary" onclick="closeFAQEditModal()" style="padding: 10px 20px;">Cancel</button>
            <button class="btn" onclick="saveFAQEdit()" style="padding: 10px 20px; background: #0891b2; color: white;">
                <span class="material-icons-round" style="vertical-align: middle; font-size: 18px;">save</span> Save Changes
            </button>
        </div>
    </div>
</div>

<!-- Crawl Preview Modal -->
<div id="crawlPreviewModal" class="modal" style="display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5); overflow: auto;">
    <div class="modal-content" style="background-color: #1e1e1e; margin: 5% auto; padding: 20px; border: 1px solid #333; border-radius: 8px; max-width: 900px; max-height: 90vh; overflow-y: auto;">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
            <h2 style="margin: 0; color: white;">Crawl Preview</h2>
            <button onclick="closeCrawlPreview()" style="background: none; border: none; color: white; font-size: 28px; cursor: pointer; padding: 0; width: 32px; height: 32px; display: flex; align-items: center; justify-content: center;">&times;</button>
        </div>
        
        <div style="margin-bottom: 15px; color: #ccc;">
            <div style="margin-bottom: 8px;"><strong>URL:</strong> <span id="previewUrl" style="color: #0891b2;"></span></div>
            <div style="margin-bottom: 8px;"><strong>Word Count:</strong> <span id="previewWordCount"></span></div>
            <div><strong>Character Count:</strong> <span id="previewCharCount"></span></div>
        </div>
        
        <div style="margin-bottom: 15px;">
            <label style="color: white; display: block; margin-bottom: 8px;"><strong>Extracted Text (You can edit before ingesting):</strong></label>
            <textarea id="previewText" class="form-control" rows="20" style="font-family: 'Courier New', monospace; font-size: 13px; background: #2a2a2a; color: #e0e0e0; border: 1px solid #444; padding: 12px; border-radius: 4px; width: 100%; resize: vertical;"></textarea>
            <small style="color: #999; display: block; margin-top: 8px;">Review the extracted text for accuracy. Edit if needed, then click "Ingest to Knowledge Base" to save.</small>
        </div>
        
        <div style="display: flex; gap: 12px; justify-content: flex-end;">
            <button class="btn btn-secondary" onclick="closeCrawlPreview()" style="padding: 10px 20px;">Cancel</button>
            <button class="btn" onclick="ingestCrawledContent()" style="padding: 10px 20px; background: #0891b2; color: white;">
                <span class="material-icons-round" style="vertical-align: middle; font-size: 18px;">save</span> Ingest to Knowledge Base
            </button>
        </div>
    </div>
</div>

<!-- File Preview Modal -->
<div id="filePreviewModal" class="modal" style="display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5); overflow: auto;">
    <div class="modal-content" style="background-color: #1e1e1e; margin: 5% auto; padding: 20px; border: 1px solid #333; border-radius: 8px; max-width: 900px; max-height: 90vh; overflow-y: auto;">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
            <h2 style="margin: 0; color: white;">File Preview</h2>
            <button onclick="closeFilePreview()" style="background: none; border: none; color: white; font-size: 28px; cursor: pointer; padding: 0; width: 32px; height: 32px; display: flex; align-items: center; justify-content: center;">&times;</button>
        </div>
        
        <div style="margin-bottom: 15px; color: #ccc;">
            <div style="margin-bottom: 8px;"><strong>Filename:</strong> <span id="previewFileName" style="color: #0891b2;"></span></div>
            <div style="margin-bottom: 8px;"><strong>Category:</strong> <span id="previewFileCategory"></span></div>
            <div style="margin-bottom: 8px;"><strong>Word Count:</strong> <span id="previewFileWordCount"></span></div>
            <div><strong>Character Count:</strong> <span id="previewFileCharCount"></span></div>
        </div>
        
        <div style="margin-bottom: 15px;">
            <label style="color: white; display: block; margin-bottom: 8px;"><strong>Extracted Text (You can edit before ingesting):</strong></label>
            <textarea id="previewFileText" class="form-control" rows="20" style="font-family: 'Courier New', monospace; font-size: 13px; background: #2a2a2a; color: #e0e0e0; border: 1px solid #444; padding: 12px; border-radius: 4px; width: 100%; resize: vertical;"></textarea>
            <small style="color: #999; display: block; margin-top: 8px;">Review the extracted text for accuracy. Edit if needed, then click "Ingest to Knowledge Base" to save.</small>
        </div>
        
        <div style="display: flex; gap: 12px; justify-content: flex-end;">
            <button class="btn btn-secondary" onclick="closeFilePreview()" style="padding: 10px 20px;">Cancel</button>
            <button class="btn" onclick="ingestFileContent()" style="padding: 10px 20px; background: #0891b2; color: white;">
                <span class="material-icons-round" style="vertical-align: middle; font-size: 18px;">save</span> Ingest to Knowledge Base
            </button>
        </div>
    </div>
</div>

