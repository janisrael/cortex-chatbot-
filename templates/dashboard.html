<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enhanced AI Dashboard</title>
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Material+Icons+Round&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/dashboard.css') }}">
</head>
<body>
    {% include 'components/dashboard_header.html' %}
    {% include 'components/website_selector.html' %}
    
    <div class="container">
        <!-- Reset Knowledge Base Section -->
        <div class="card full-width" style="border: 2px solid #dc3545;">
            <h2 style="color: #dc3545;">ğŸ—‘ï¸ Reset Knowledge Base</h2>
            
            <div class="alert alert-success" id="resetSuccess"></div>
            <div class="alert alert-error" id="resetError"></div>
            
            <div style="background: #fff3cd; border: 1px solid #ffeaa7; border-radius: 8px; padding: 15px; margin-bottom: 20px;">
                <strong>âš ï¸ Warning:</strong> These actions permanently delete data. Always create a backup first!
            </div>
            
            <!-- Backup Section -->
            <div style="background: #f8f9fa; border-radius: 8px; padding: 20px; margin-bottom: 20px;">
                <h3 style="margin-bottom: 15px; color: #495057;">ğŸ“¥ Backup & Restore</h3>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 15px;">
                    <button class="btn" onclick="createBackup()" id="backupBtn" style="background: #28a745;">
                        ğŸ’¾ Create Backup
                    </button>
                    <button class="btn" onclick="loadBackupList()" id="listBackupsBtn" style="background: #17a2b8;">
                        ğŸ“‹ View Backups
                    </button>
                </div>
                
                <div class="loading" id="backupLoading">
                    <div class="spinner"></div>
                    Creating backup...
                </div>
                
                <!-- Backup List -->
                <div id="backupsList" style="display: none;">
                    <h4>Available Backups:</h4>
                    <div id="backupsContainer" style="max-height: 200px; overflow-y: auto; border: 1px solid #ddd; border-radius: 4px; padding: 10px;">
                        <!-- Backups will be loaded here -->
                    </div>
                </div>
            </div>
            
            <!-- Reset Options -->
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px; margin-bottom: 20px;">
                <div class="reset-option">
                    <h4>ğŸ—‚ï¸ Files Only</h4>
                    <p>Remove all uploaded files but keep vector database and logs</p>
                    <button class="btn btn-danger" onclick="showResetModal('files')">Reset Files</button>
                </div>
                
                <div class="reset-option">
                    <h4>ğŸ§  Vector Database</h4>
                    <p>Clear learned embeddings but keep uploaded files</p>
                    <button class="btn btn-danger" onclick="showResetModal('vectors')">Reset Vectors</button>
                </div>
                
                <div class="reset-option">
                    <h4>ğŸ“Š Logs & Analytics</h4>
                    <p>Clear chat logs and learning data</p>
                    <button class="btn btn-danger" onclick="showResetModal('logs')">Reset Logs</button>
                </div>
                
                <div class="reset-option">
                    <h4>ğŸ’¾ Database</h4>
                    <p>Clear all conversation history from database</p>
                    <button class="btn btn-danger" onclick="showResetModal('database')">Reset Database</button>
                </div>
                
                <div class="reset-option">
                    <h4>ğŸ“ Prompt</h4>
                    <p>Reset system prompt to default</p>
                    <button class="btn btn-danger" onclick="showResetModal('prompt')">Reset Prompt</button>
                </div>
                
                <div class="reset-option" style="border: 2px solid #dc3545;">
                    <h4>ğŸ’¥ EVERYTHING</h4>
                    <p>Complete reset - all files, vectors, logs, database, prompt</p>
                    <button class="btn btn-danger" onclick="showResetModal('all')" style="background: #dc3545;">RESET ALL</button>
                </div>
            </div>
            
            <!-- Knowledge Base Stats -->
            <div style="background: #e9ecef; border-radius: 8px; padding: 15px;">
                <h4>ğŸ“ˆ Current Knowledge Base Stats</h4>
                <div id="knowledgeStats" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 10px; margin-top: 10px;">
                    <div class="stat-item">
                        <strong id="vectorCount">-</strong>
                        <div>Vector Documents</div>
                    </div>
                    <div class="stat-item">
                        <strong id="fileCount">-</strong>
                        <div>Uploaded Files</div>
                    </div>
                    <div class="stat-item">
                        <strong id="chatLogCount">-</strong>
                        <div>Chat Logs</div>
                    </div>
                    <div class="stat-item">
                        <strong id="userCount">-</strong>
                        <div>Users</div>
                    </div>
                    <div class="stat-item">
                        <strong id="backupCount">-</strong>
                        <div>Backups</div>
                    </div>
                </div>
            </div>
        </div>

        <div class="dashboard-grid">
            <!-- Enhanced File Upload Section -->
            <div class="card">
                <h2>ğŸ“ Upload Documents by Category</h2>
                
                <div class="alert alert-success" id="uploadSuccess"></div>
                <div class="alert alert-error" id="uploadError"></div>
                
                <!-- Category Selection -->
                <div class="category-tabs" id="categoryTabs">
                    <!-- Categories will be loaded dynamically -->
                </div>
                
                <div class="selected-category-info" id="selectedCategoryInfo">
                    <div class="selected-category-name">Company Details</div>
                    <div class="category-description">Business information, services, team details, contact info</div>
                </div>
                
                <div class="file-upload" id="fileUpload">
                    <div style="font-size: 48px; margin-bottom: 15px;">ğŸ“„</div>
                    <p><strong>Drop files here or click to browse</strong></p>
                    <p>Supported: PDF, TXT, DOC, DOCX, CSV (Max 16MB)</p>
                    <input type="file" id="fileInput" multiple accept=".pdf,.txt,.doc,.docx,.csv">
                </div>
                
                <div class="loading" id="uploadLoading">
                    <div class="spinner"></div>
                    Processing file...
                </div>
            </div>

            <!-- URL Crawling Section -->
            <div class="card">
                <h2>ğŸŒ Crawl Websites</h2>
                
                <div class="alert alert-success" id="crawlSuccess"></div>
                <div class="alert alert-error" id="crawlError"></div>
                
                <div class="form-group">
                    <label for="urlInput">Website URL</label>
                    <div style="display: flex; gap: 12px; align-items: end;">
                        <div style="flex: 1;">
                            <input type="url" id="urlInput" class="form-control" placeholder="https://example.com">
                        </div>
                        <div>
                            <input type="number" id="maxPages" class="form-control" value="10" min="1" max="50" style="width: 80px;" title="Max pages">
                        </div>
                        <button class="btn" onclick="crawlUrl()" id="crawlBtn">
                            ğŸ•·ï¸ Crawl
                        </button>
                    </div>
                </div>

                <div class="loading" id="crawlLoading">
                    <div class="spinner"></div>
                    Crawling website...
                </div>
            </div>
        </div>

        <!-- Files by Category Display -->
        <div class="card full-width">
            <h2>ğŸ“‚ Files by Category</h2>
            <div class="files-by-category" id="filesByCategory">
                Loading files...
            </div>
        </div>

        <!-- Prompt Editor Section -->
        <div class="card full-width">
            <h2>âœï¸ Edit System Prompt</h2>
            
            <div class="alert alert-success" id="promptSuccess"></div>
            <div class="alert alert-error" id="promptError"></div>
            
            <div class="form-group">
                <label for="promptEditor">System Prompt Template</label>
                <textarea id="promptEditor" class="form-control prompt-editor" placeholder="Loading prompt..."></textarea>
                <small style="color: #666; margin-top: 5px; display: block;">
                    Use {context} for retrieved information and {question} for user input. HTML formatting supported.
                </small>
            </div>
            
            <div style="display: flex; gap: 12px;">
                <button class="btn" onclick="savePrompt()" id="savePromptBtn">
                    ğŸ’¾ Save Prompt
                </button>
                <button class="btn" onclick="resetPrompt()" style="background: #6c757d;">
                    ğŸ”„ Reset to Default
                </button>
                <button class="btn" onclick="testPrompt()" style="background: #28a745;">
                    ğŸ§ª Test Prompt
                </button>
            </div>

            <div class="loading" id="promptLoading">
                <div class="spinner"></div>
                Updating prompt...
            </div>
        </div>
    </div>

    {% include 'components/dashboard_modals.html' %}

    <!-- JavaScript Modules -->
    <script src="{{ url_for('static', filename='js/dashboard/utils.js') }}"></script>
    <script src="{{ url_for('static', filename='js/dashboard/core.js') }}"></script>
    <script src="{{ url_for('static', filename='js/dashboard/website.js') }}"></script>
    <script src="{{ url_for('static', filename='js/dashboard/file_management.js') }}"></script>
    <script src="{{ url_for('static', filename='js/dashboard/knowledge.js') }}"></script>
    <script src="{{ url_for('static', filename='js/dashboard/reset.js') }}"></script>
</body>
</html>
