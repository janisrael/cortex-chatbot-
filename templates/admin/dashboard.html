<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cortex AI - Admin Dashboard</title>
    <link rel="icon" type="image/x-icon" href="/static/favicon.ico">
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Material+Icons+Round&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/static/v2/css/dashboard.css?v=12">
    <script src="https://cdn.jsdelivr.net/npm/apexcharts@3.44.0/dist/apexcharts.min.js"></script>
</head>
<body>
    {% include 'components/dashboard_header_v2.html' %}

    <div class="container" style="max-width: 1400px; margin: 0 auto; padding: 20px;">
        <div style="margin-bottom: 20px;">
            <h1 style="font-size: 32px; font-weight: 700; color: #1e293b; margin-bottom: 10px;">
                <span class="material-icons-round" style="font-size: 36px; vertical-align: middle; margin-right: 10px;">admin_panel_settings</span>
                Admin Dashboard
            </h1>
            <p style="color: #64748b; font-size: 16px;">Manage users, monitor sales, and configure admin settings</p>
        </div>

        <!-- Admin Tabs -->
        <div class="tab-navigation" style="margin-bottom: 20px;">
            <button class="tab-button active admin-tab-button" data-tab="users" onclick="switchAdminTab('users')">
                Users
            </button>
            <button class="tab-button admin-tab-button" data-tab="sales" onclick="switchAdminTab('sales')">
                Sales
            </button>
            <button class="tab-button admin-tab-button" data-tab="analytics" onclick="switchAdminTab('analytics')">
                Analytics
            </button>
            <button class="tab-button admin-tab-button" data-tab="settings" onclick="switchAdminTab('settings')">
                Settings
            </button>
        </div>

        <!-- Users Tab (existing content) -->
        <div id="admin-tab-users" class="tab-content admin-tab-content active">
            <!-- System Statistics Cards -->
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 30px;">
                <!-- Total Users Card -->
                <div class="metric-card" style="background: white; border: 2px solid #e1e5e9; border-radius: 12px; padding: 20px; transition: all 0.3s ease;">
                    <div style="display: flex; align-items: center; gap: 15px;">
                        <div class="metric-icon" style="width: 56px; height: 56px; background: linear-gradient(135deg, #0891b2 0%, #0f766e 100%); border-radius: 12px; display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
                            <span class="material-icons-round" style="font-size: 28px; color: white;">people</span>
                        </div>
                        <div style="flex: 1; min-width: 0;">
                            <div style="font-size: 14px; color: #64748b; font-weight: 500; margin-bottom: 4px;">Total Users</div>
                            <div style="font-size: 24px; font-weight: 700; color: #1e293b;" id="totalUsers">-</div>
                            <div style="font-size: 12px; color: #94a3b8; margin-top: 4px;" id="activeUsers">Active: -</div>
                        </div>
                    </div>
                </div>

                <!-- Total Files Card -->
                <div class="metric-card" style="background: white; border: 2px solid #e1e5e9; border-radius: 12px; padding: 20px; transition: all 0.3s ease;">
                    <div style="display: flex; align-items: center; gap: 15px;">
                        <div class="metric-icon" style="width: 56px; height: 56px; background: linear-gradient(135deg, #0891b2 0%, #0f766e 100%); border-radius: 12px; display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
                            <span class="material-icons-round" style="font-size: 28px; color: white;">description</span>
                        </div>
                        <div style="flex: 1; min-width: 0;">
                            <div style="font-size: 14px; color: #64748b; font-weight: 500; margin-bottom: 4px;">Total Files</div>
                            <div style="font-size: 24px; font-weight: 700; color: #1e293b;" id="totalFiles">-</div>
                            <div style="font-size: 12px; color: #94a3b8; margin-top: 4px;">Uploaded by all users</div>
                        </div>
                    </div>
                </div>

                <!-- Total Crawls Card -->
                <div class="metric-card" style="background: white; border: 2px solid #e1e5e9; border-radius: 12px; padding: 20px; transition: all 0.3s ease;">
                    <div style="display: flex; align-items: center; gap: 15px;">
                        <div class="metric-icon" style="width: 56px; height: 56px; background: linear-gradient(135deg, #0891b2 0%, #0f766e 100%); border-radius: 12px; display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
                            <span class="material-icons-round" style="font-size: 28px; color: white;">language</span>
                        </div>
                        <div style="flex: 1; min-width: 0;">
                            <div style="font-size: 14px; color: #64748b; font-weight: 500; margin-bottom: 4px;">Total URLs Crawled</div>
                            <div style="font-size: 24px; font-weight: 700; color: #1e293b;" id="totalCrawls">-</div>
                            <div style="font-size: 12px; color: #94a3b8; margin-top: 4px;">Crawled by all users</div>
                        </div>
                    </div>
                </div>

                <!-- Total FAQs Card -->
                <div class="metric-card" style="background: white; border: 2px solid #e1e5e9; border-radius: 12px; padding: 20px; transition: all 0.3s ease;">
                    <div style="display: flex; align-items: center; gap: 15px;">
                        <div class="metric-icon" style="width: 56px; height: 56px; background: linear-gradient(135deg, #0891b2 0%, #0f766e 100%); border-radius: 12px; display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
                            <span class="material-icons-round" style="font-size: 28px; color: white;">help_center</span>
                        </div>
                        <div style="flex: 1; min-width: 0;">
                            <div style="font-size: 14px; color: #64748b; font-weight: 500; margin-bottom: 4px;">Total FAQs</div>
                            <div style="font-size: 24px; font-weight: 700; color: #1e293b;" id="totalFaqs">-</div>
                            <div style="font-size: 12px; color: #94a3b8; margin-top: 4px;">Created by all users</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Users Table -->
            <div style="background: white; border: 2px solid #e1e5e9; border-radius: 12px; padding: 24px; margin-bottom: 30px;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h2 style="font-size: 20px; font-weight: 600; color: #1e293b; margin: 0;">
                        <span class="material-icons-round" style="font-size: 24px; vertical-align: middle; margin-right: 8px;">group</span>
                        All Users
                    </h2>
                    <button id="refreshUsersBtn" class="btn" style="padding: 8px 16px; font-size: 14px; background: #0891b2; color: white; border: none; border-radius: 8px; cursor: pointer; display: flex; align-items: center; gap: 6px;">
                        <span class="material-icons-round" style="font-size: 18px;">refresh</span>
                        Refresh
                    </button>
                </div>

                <div style="overflow-x: auto;">
                    <table style="width: 100%; border-collapse: collapse;">
                        <thead>
                            <tr style="border-bottom: 2px solid #e1e5e9;">
                                <th style="text-align: center; padding: 12px; font-weight: 600; color: #64748b; font-size: 14px; width: 60px;">#</th>
                                <th style="text-align: left; padding: 12px; font-weight: 600; color: #64748b; font-size: 14px;">User</th>
                                <th style="text-align: left; padding: 12px; font-weight: 600; color: #64748b; font-size: 14px;">Role</th>
                                <th style="text-align: left; padding: 12px; font-weight: 600; color: #64748b; font-size: 14px;">Files</th>
                                <th style="text-align: left; padding: 12px; font-weight: 600; color: #64748b; font-size: 14px;">URLs</th>
                                <th style="text-align: left; padding: 12px; font-weight: 600; color: #64748b; font-size: 14px;">FAQs</th>
                                <th style="text-align: left; padding: 12px; font-weight: 600; color: #64748b; font-size: 14px;">Registered</th>
                                <th style="text-align: left; padding: 12px; font-weight: 600; color: #64748b; font-size: 14px;">Last Login</th>
                            </tr>
                        </thead>
                        <tbody id="usersTableBody">
                            <tr>
                                <td colspan="8" style="text-align: center; padding: 40px; color: #64748b;">                                               
                                    <span class="material-icons-round" style="font-size: 48px; color: #cbd5e1; display: block; margin-bottom: 10px;">hourglass_empty</span>                                                            
                                    Loading users...
                                </td>
                            </tr>
                        </tbody>
                    </table>
                    <!-- Users Pagination -->
                    <div id="usersPagination" style="background: white; border-top: 1px solid #e1e5e9; border-radius: 0 0 12px 12px;"></div>
                </div>
            </div>
        </div>

        <!-- Sales Tab -->
        <div id="admin-tab-sales" class="tab-content admin-tab-content" style="display: none;">
            <!-- Sales Metrics Cards -->
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 30px;">
                <!-- Total Revenue Card -->
                <div class="metric-card" style="background: white; border: 2px solid #e1e5e9; border-radius: 12px; padding: 20px; transition: all 0.3s ease;">
                    <div style="display: flex; align-items: center; gap: 15px;">
                        <div class="metric-icon" style="width: 56px; height: 56px; background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%); border-radius: 12px; display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
                            <span class="material-icons-round" style="font-size: 28px; color: white;">attach_money</span>
                        </div>
                        <div style="flex: 1; min-width: 0;">
                            <div style="font-size: 14px; color: #64748b; font-weight: 500; margin-bottom: 4px;">Total Revenue</div>
                            <div style="font-size: 24px; font-weight: 700; color: #1e293b;" id="totalRevenue">$12,450.00</div>
                            <div style="font-size: 12px; color: #22c55e; margin-top: 4px;">↑ 12.5% from last month</div>
                        </div>
                    </div>
                </div>

                <!-- Active Subscriptions Card -->
                <div class="metric-card" style="background: white; border: 2px solid #e1e5e9; border-radius: 12px; padding: 20px; transition: all 0.3s ease;">
                    <div style="display: flex; align-items: center; gap: 15px;">
                        <div class="metric-icon" style="width: 56px; height: 56px; background: linear-gradient(135deg, #0891b2 0%, #0f766e 100%); border-radius: 12px; display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
                            <span class="material-icons-round" style="font-size: 28px; color: white;">subscriptions</span>
                        </div>
                        <div style="flex: 1; min-width: 0;">
                            <div style="font-size: 14px; color: #64748b; font-weight: 500; margin-bottom: 4px;">Active Subscriptions</div>
                            <div style="font-size: 24px; font-weight: 700; color: #1e293b;" id="activeSubscriptions">47</div>
                            <div style="font-size: 12px; color: #94a3b8; margin-top: 4px;">3 new this month</div>
                        </div>
                    </div>
                </div>

                <!-- Monthly Recurring Revenue Card -->
                <div class="metric-card" style="background: white; border: 2px solid #e1e5e9; border-radius: 12px; padding: 20px; transition: all 0.3s ease;">
                    <div style="display: flex; align-items: center; gap: 15px;">
                        <div class="metric-icon" style="width: 56px; height: 56px; background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%); border-radius: 12px; display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
                            <span class="material-icons-round" style="font-size: 28px; color: white;">repeat</span>
                        </div>
                        <div style="flex: 1; min-width: 0;">
                            <div style="font-size: 14px; color: #64748b; font-weight: 500; margin-bottom: 4px;">Monthly Recurring Revenue</div>
                            <div style="font-size: 24px; font-weight: 700; color: #1e293b;" id="monthlyRevenue">$4,150.00</div>
                            <div style="font-size: 12px; color: #22c55e; margin-top: 4px;">↑ 8.2% growth</div>
                        </div>
                    </div>
                </div>

                <!-- Churn Rate Card -->
                <div class="metric-card" style="background: white; border: 2px solid #e1e5e9; border-radius: 12px; padding: 20px; transition: all 0.3s ease;">
                    <div style="display: flex; align-items: center; gap: 15px;">
                        <div class="metric-icon" style="width: 56px; height: 56px; background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); border-radius: 12px; display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
                            <span class="material-icons-round" style="font-size: 28px; color: white;">trending_down</span>
                        </div>
                        <div style="flex: 1; min-width: 0;">
                            <div style="font-size: 14px; color: #64748b; font-weight: 500; margin-bottom: 4px;">Churn Rate</div>
                            <div style="font-size: 24px; font-weight: 700; color: #1e293b;" id="churnRate">2.1%</div>
                            <div style="font-size: 12px; color: #22c55e; margin-top: 4px;">↓ 0.5% improvement</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Subscription Details Table -->
            <div style="background: white; border: 2px solid #e1e5e9; border-radius: 12px; padding: 24px; margin-bottom: 30px;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h2 style="font-size: 20px; font-weight: 600; color: #1e293b; margin: 0;">
                        <span class="material-icons-round" style="font-size: 24px; vertical-align: middle; margin-right: 8px;">receipt_long</span>
                        Subscription Details
                    </h2>
                    <button id="refreshSubscriptionsBtn" class="btn" style="padding: 8px 16px; font-size: 14px; background: #0891b2; color: white; border: none; border-radius: 8px; cursor: pointer; display: flex; align-items: center; gap: 6px;">
                        <span class="material-icons-round" style="font-size: 18px;">refresh</span>
                        Refresh
                    </button>
                </div>

                <div style="overflow-x: auto;">
                    <table style="width: 100%; border-collapse: collapse;">
                        <thead>
                            <tr style="border-bottom: 2px solid #e1e5e9;">
                                <th style="text-align: left; padding: 12px; font-weight: 600; color: #64748b; font-size: 14px;">User</th>
                                <th style="text-align: left; padding: 12px; font-weight: 600; color: #64748b; font-size: 14px;">Plan</th>
                                <th style="text-align: left; padding: 12px; font-weight: 600; color: #64748b; font-size: 14px;">Status</th>
                                <th style="text-align: left; padding: 12px; font-weight: 600; color: #64748b; font-size: 14px;">Amount</th>
                                <th style="text-align: left; padding: 12px; font-weight: 600; color: #64748b; font-size: 14px;">Billing Cycle</th>
                                <th style="text-align: left; padding: 12px; font-weight: 600; color: #64748b; font-size: 14px;">Next Billing</th>
                                <th style="text-align: left; padding: 12px; font-weight: 600; color: #64748b; font-size: 14px;">Started</th>
                            </tr>
                        </thead>
                        <tbody id="subscriptionsTableBody">
                            <tr>
                                <td colspan="8" style="text-align: center; padding: 40px; color: #64748b;">                                               
                                    <span class="material-icons-round" style="font-size: 48px; color: #cbd5e1; display: block; margin-bottom: 10px;">hourglass_empty</span>                                                            
                                    Loading subscriptions...
                                </td>
                            </tr>
                        </tbody>
                    </table>
                    <!-- Subscriptions Pagination -->
                    <div id="subscriptionsPagination" style="background: white; border-top: 1px solid #e1e5e9; border-radius: 0 0 12px 12px;"></div>
                </div>
            </div>
        </div>

        <!-- Analytics Tab -->
        <div id="admin-tab-analytics" class="tab-content admin-tab-content" style="display: none;">
            <!-- Charts Grid -->
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(500px, 1fr)); gap: 20px; margin-bottom: 30px;">
                <!-- User Growth Chart -->
                <div style="background: white; border: 2px solid #e1e5e9; border-radius: 12px; padding: 24px;">
                    <h3 style="font-size: 18px; font-weight: 600; color: #1e293b; margin-bottom: 20px;">
                        <span class="material-icons-round" style="font-size: 20px; vertical-align: middle; margin-right: 8px;">trending_up</span>
                        User Growth Over Time
                    </h3>
                    <div id="userGrowthChart" style="min-height: 300px;"></div>
                </div>

                <!-- Revenue Trend Chart -->
                <div style="background: white; border: 2px solid #e1e5e9; border-radius: 12px; padding: 24px;">
                    <h3 style="font-size: 18px; font-weight: 600; color: #1e293b; margin-bottom: 20px;">
                        <span class="material-icons-round" style="font-size: 20px; vertical-align: middle; margin-right: 8px;">attach_money</span>
                        Revenue Trend
                    </h3>
                    <div id="revenueTrendChart" style="min-height: 300px;"></div>
                </div>

                <!-- Plan Distribution Chart -->
                <div style="background: white; border: 2px solid #e1e5e9; border-radius: 12px; padding: 24px;">
                    <h3 style="font-size: 18px; font-weight: 600; color: #1e293b; margin-bottom: 20px;">
                        <span class="material-icons-round" style="font-size: 20px; vertical-align: middle; margin-right: 8px;">pie_chart</span>
                        Subscription Plan Distribution
                    </h3>
                    <div id="planDistributionChart" style="min-height: 300px;"></div>
                </div>

                <!-- Knowledge Base Usage Chart -->
                <div style="background: white; border: 2px solid #e1e5e9; border-radius: 12px; padding: 24px;">
                    <h3 style="font-size: 18px; font-weight: 600; color: #1e293b; margin-bottom: 20px;">
                        <span class="material-icons-round" style="font-size: 20px; vertical-align: middle; margin-right: 8px;">bar_chart</span>
                        Knowledge Base Usage
                    </h3>
                    <div id="knowledgeBaseChart" style="min-height: 300px;"></div>
                </div>

                <!-- Active Users Chart -->
                <div style="background: white; border: 2px solid #e1e5e9; border-radius: 12px; padding: 24px;">
                    <h3 style="font-size: 18px; font-weight: 600; color: #1e293b; margin-bottom: 20px;">
                        <span class="material-icons-round" style="font-size: 20px; vertical-align: middle; margin-right: 8px;">people</span>
                        Active Users (Last 30 Days)
                    </h3>
                    <div id="activeUsersChart" style="min-height: 300px;"></div>
                </div>

                <!-- Revenue by Plan Chart -->
                <div style="background: white; border: 2px solid #e1e5e9; border-radius: 12px; padding: 24px;">
                    <h3 style="font-size: 18px; font-weight: 600; color: #1e293b; margin-bottom: 20px;">
                        <span class="material-icons-round" style="font-size: 20px; vertical-align: middle; margin-right: 8px;">account_balance_wallet</span>
                        Revenue by Plan Type
                    </h3>
                    <div id="revenueByPlanChart" style="min-height: 300px;"></div>
                </div>
            </div>
        </div>

        <!-- Settings Tab -->
        <div id="admin-tab-settings" class="tab-content admin-tab-content" style="display: none;">
            <div style="background: white; border: 2px solid #e1e5e9; border-radius: 12px; padding: 24px; margin-bottom: 20px;">
                <h2 style="font-size: 20px; font-weight: 600; color: #1e293b; margin-bottom: 10px;">
                    <span class="material-icons-round" style="font-size: 24px; vertical-align: middle; margin-right: 8px;">settings</span>
                    Admin Settings
                </h2>
                <p style="color: #64748b; font-size: 14px; margin-bottom: 16px;">
                    Configure global admin options. These settings will affect all users in the system.
                </p>

                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(260px, 1fr)); gap: 16px;">
                    <div style="border-radius: 12px; border: 1px solid #e5e7eb; padding: 16px; background: #f9fafb;">
                        <h3 style="font-size: 16px; font-weight: 600; color: #111827; margin-bottom: 8px;">
                            <span class="material-icons-round" style="font-size: 18px; vertical-align: middle; margin-right: 6px;">shield</span>
                            RBAC & Permissions
                        </h3>
                        <p style="color: #6b7280; font-size: 13px; margin-bottom: 10px;">
                            Manage roles and access levels for users (admin, user, viewer). Future UI will be added here.
                        </p>
                        <span style="display: inline-flex; align-items: center; gap: 6px; font-size: 12px; color: #9ca3af;">
                            <span class="material-icons-round" style="font-size: 16px;">info</span>
                            Configuration will be editable in a later phase.
                        </span>
                    </div>

                    <div style="border-radius: 12px; border: 1px solid #e5e7eb; padding: 16px; background: #f9fafb;">
                        <h3 style="font-size: 16px; font-weight: 600; color: #111827; margin-bottom: 8px;">
                            <span class="material-icons-round" style="font-size: 18px; vertical-align: middle; margin-right: 6px;">notifications</span>
                            System Notifications
                        </h3>
                        <p style="color: #6b7280; font-size: 13px; margin-bottom: 10px;">
                            Control global email alerts and admin notifications for errors, subscription events, and more.
                        </p>
                        <span style="display: inline-flex; align-items: center; gap: 6px; font-size: 12px; color: #9ca3af;">
                            <span class="material-icons-round" style="font-size: 16px;">schedule</span>
                            Placeholder – wiring to email system will be added later.
                        </span>
                    </div>

                    <div style="border-radius: 12px; border: 1px solid #e5e7eb; padding: 16px; background: #f9fafb;">
                        <h3 style="font-size: 16px; font-weight: 600; color: #111827; margin-bottom: 8px;">
                            <span class="material-icons-round" style="font-size: 18px; vertical-align: middle; margin-right: 6px;">build</span>
                            Maintenance Tools
                        </h3>
                        <p style="color: #6b7280; font-size: 13px; margin-bottom: 10px;">
                            Future maintenance utilities like clearing caches, triggering backups, and viewing system health.
                        </p>
                        <span style="display: inline-flex; align-items: center; gap: 6px; font-size: 12px; color: #9ca3af;">
                            <span class="material-icons-round" style="font-size: 16px;">construction</span>
                            Design only – backend actions to be implemented.
                        </span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    {% include 'components/dashboard_footer.html' %}

    <script src="/static/v2/js/dashboard-core.js?v=2"></script>
    <script src="/static/v2/js/dashboard-utils.js?v=2"></script>
    <script src="/static/v2/js/notification-system.js?v=2"></script>
    <script src="/static/v2/js/admin-dashboard.js?v=1"></script>
</body>
</html>

