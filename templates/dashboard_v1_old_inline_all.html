<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cortex AI - Dashboard</title>
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" rel="stylesheet">
    <link rel="stylesheet" href="/static/v2/css/dashboard.css">
</head>
<body>
    <div class="header">
        <div class="header-content">
            <h1>Cortex AI - Dashboard</h1>
            <div class="nav-links">
                <a href="/chat-interface">Chat Interface</a>
                <a href="/demo">Widget Preview</a>
                <a href="/health">System Health</a>
            </div>
        </div>
    </div>

    <div class="container">
        <!-- Tab Navigation -->
        <div class="tab-navigation">
            <button class="tab-button active" onclick="switchTab('overview')">
                 Overview
            </button>
            <button class="tab-button" onclick="switchTab('llm')">
                 LLM Configuration
            </button>
            <button class="tab-button" onclick="switchTab('knowledge')">
                 Knowledge Management
            </button>
            <button class="tab-button" onclick="switchTab('prompt')">
                 Prompt Editor
            </button>
            <button class="tab-button" onclick="switchTab('integration')">
                 Widget Integration
            </button>
            <button class="tab-button" onclick="switchTab('system')">
                 System Management
            </button>
        </div>

        <!-- Overview Tab -->
        <div id="overview-tab" class="tab-content active">
            <!-- Statistics Section -->
            <div class="stats-grid" id="statsGrid">
                <div class="stat-card">
                    <div class="stat-value" id="totalDocs">-</div>
                    <div class="stat-label">Documents</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="totalFiles">-</div>
                    <div class="stat-label">Uploaded Files</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="llmModel">-</div>
                    <div class="stat-label">LLM Model</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="currentWebsite">-</div>
                    <div class="stat-label">Current Website</div>
                </div>
            </div>

            <!-- System Status -->
            <div class="card">
                <h2>üîã System Status</h2>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px;">
                    <div style="text-align: center; padding: 20px; background: #f8f9fa; border-radius: 8px;">
                        <div style="font-size: 24px; margin-bottom: 10px;">ü§ñ</div>
                        <div style="font-weight: 600; margin-bottom: 5px;">LLM Status</div>
                        <span class="status-indicator" id="systemLLMStatus">
                            <span class="status-dot" id="systemLLMDot"></span>
                            <span id="systemLLMText">Loading...</span>
                        </span>
                    </div>
                    <div style="text-align: center; padding: 20px; background: #f8f9fa; border-radius: 8px;">
                        <div style="font-size: 24px; margin-bottom: 10px;">üß†</div>
                        <div style="font-weight: 600; margin-bottom: 5px;">Vector Store</div>
                        <span class="status-indicator status-active">
                            <span class="status-dot active"></span>
                            Active
                        </span>
                    </div>
                    <div style="text-align: center; padding: 20px; background: #f8f9fa; border-radius: 8px;">
                        <div style="font-size: 24px; margin-bottom: 10px;">üíæ</div>
                        <div style="font-weight: 600; margin-bottom: 5px;">Database</div>
                        <span class="status-indicator status-active">
                            <span class="status-dot active"></span>
                            Connected
                        </span>
                    </div>
                </div>
            </div>

            <!-- File List -->
            <div class="card">
                <h2>üìÅ Recent Files</h2>
                <div class="file-list" id="overviewFileList">
                    Loading files...
                </div>
            </div>
        </div>

        <!-- LLM Configuration Tab -->
        <div id="llm-tab" class="tab-content">
            <div class="card">
                <h2>‚öôÔ∏è LLM Configuration</h2>
                
                <div class="alert alert-success" id="llmSuccess"></div>
                <div class="alert alert-error" id="llmError"></div>

                <!-- Website Selector -->
                <div style="margin-bottom: 20px;">
                    <label>Configure LLM for Website:</label>
                    <div class="website-tabs" id="websiteTabs">
                        <!-- Dynamically populated -->
                    </div>
                </div>

                <!-- Global Configuration -->
                <div style="border: 2px solid #e9ecef; border-radius: 12px; padding: 20px; margin-bottom: 20px;">
                    <h3 style="margin-bottom: 15px; color: #495057;">Global LLM Settings</h3>

                    <div class="provider-tabs">
                        <button class="provider-tab active" id="globalOpenaiTab" onclick="selectGlobalProvider('openai')">
                            OpenAI
                        </button>
                        <button class="provider-tab" id="globalOllamaTab" onclick="selectGlobalProvider('ollama')">
                            Ollama (Local)
                        </button>
                    </div>

                    <!-- OpenAI Configuration -->
                    <div class="provider-config active" id="globalOpenaiConfig">
                        <div class="form-group">
                            <label for="globalOpenaiKey">OpenAI API Key</label>
                            <input type="password" id="globalOpenaiKey" class="form-control" 
                                   placeholder="sk-proj-... (leave empty to keep current)">
                        </div>
                        
                        <div class="config-row">
                            <div class="form-group">
                                <label for="globalOpenaiDefaultModel">Default Model</label>
                                <select id="globalOpenaiDefaultModel" class="form-control">
                                    <option value="gpt-4o-mini">GPT-4o Mini (Recommended)</option>
                                    <option value="gpt-4o">GPT-4o</option>
                                    <option value="gpt-4">GPT-4</option>
                                    <option value="gpt-3.5-turbo">GPT-3.5 Turbo</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="globalProvider">Global Provider</label>
                                <select id="globalProvider" class="form-control">
                                    <option value="openai">OpenAI</option>
                                    <option value="ollama">Ollama</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Ollama Configuration -->
                    <div class="provider-config" id="globalOllamaConfig">
                        <div class="config-row">
                            <div class="form-group">
                                <label for="globalOllamaUrl">Ollama Server URL</label>
                                <input type="url" id="globalOllamaUrl" class="form-control" 
                                       value="http://localhost:11434">
                            </div>
                            <div class="form-group">
                                <label for="globalOllamaDefaultModel">Default Model</label>
                                <select id="globalOllamaDefaultModel" class="form-control">
                                    <option value="llama3.1:8b">Llama 3.1 8B</option>
                                    <option value="llama3.1:70b">Llama 3.1 70B</option>
                                    <option value="mistral">Mistral</option>
                                    <option value="codellama">CodeLlama</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <button class="btn" onclick="saveGlobalConfig()" id="saveGlobalBtn">
                        üíæ Save Global Settings
                    </button>
                </div>

                <!-- Website-Specific Override -->
                <div style="border: 2px solid #e9ecef; border-radius: 12px; padding: 20px; margin-bottom: 20px;">
                    <h3 style="margin-bottom: 15px; color: #495057;">Website-Specific Override</h3>
                    <small style="color: #666; margin-bottom: 15px; display: block;">Override global settings for <span id="currentWebsiteName">selected website</span></small>

                    <div class="config-row">
                        <div class="form-group">
                            <label for="websiteProvider">LLM Provider</label>
                            <select id="websiteProvider" class="form-control">
                                <option value="">Use Global Default</option>
                                <option value="openai">OpenAI</option>
                                <option value="ollama">Ollama</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="websiteTemperature">Temperature</label>
                            <input type="number" id="websiteTemperature" class="form-control" 
                                   min="0" max="2" step="0.1" placeholder="Global default">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="websiteModel">Model</label>
                        <input type="text" id="websiteModel" class="form-control" 
                               placeholder="Leave empty to use provider default">
                    </div>

                    <div style="display: flex; gap: 12px;">
                        <button class="btn" onclick="saveWebsiteConfig()" id="saveWebsiteBtn">
                            üíæ Save Website Override
                        </button>
                        <button class="btn btn-secondary" onclick="clearWebsiteConfig()" id="clearWebsiteBtn">
                            üóëÔ∏è Clear Override
                        </button>
                    </div>
                </div>

                <!-- Testing Section -->
                <div style="border: 2px solid #e9ecef; border-radius: 12px; padding: 20px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                        <h3 style="color: #495057;">LLM Testing</h3>
                        <span class="status-indicator" id="llmStatusIndicator">
                            <span class="status-dot" id="llmStatusDot"></span>
                            <span id="llmStatusText">Loading...</span>
                        </span>
                    </div>

                    <button class="btn btn-success" onclick="testLLM()" id="testLLMBtn">
                        üß™ Test Current Configuration
                    </button>

                    <div class="loading" id="llmLoading">
                        <div class="spinner"></div>
                        Processing LLM request...
                    </div>

                    <div class="test-response" id="testResponse"></div>
                </div>
            </div>
        </div>

        <!-- Knowledge Management Tab -->
        <div id="knowledge-tab" class="tab-content">
            <div class="dashboard-grid">
                <!-- File Upload -->
                <div class="card">
                    <h2>üìÅ Upload Documents</h2>
                    
                    <div class="alert alert-success" id="uploadSuccess"></div>
                    <div class="alert alert-error" id="uploadError"></div>

                    <!-- Category Selection -->
                    <div class="form-group">
                        <label>Document Category</label>
                        <div class="category-tabs" id="categoryTabs">
                            <!-- Dynamically populated -->
                        </div>
                    </div>
                    
                    <div class="file-upload" id="fileUpload">
                        <div class="upload-icon">üìÅ</div>
                        <p><strong>Drop files here or click to browse</strong></p>
                        <p>Supported: PDF, TXT, DOC, DOCX, CSV (Max 16MB)</p>
                        <input type="file" id="fileInput" multiple accept=".pdf,.txt,.doc,.docx,.csv">
                    </div>
                    
                    <div class="loading" id="uploadLoading">
                        <div class="spinner"></div>
                        Processing file...
                    </div>
                </div>

                <!-- URL Crawling -->
                <div class="card">
                    <h2>üåê Crawl Websites</h2>
                    
                    <div class="alert alert-success" id="crawlSuccess"></div>
                    <div class="alert alert-error" id="crawlError"></div>
                    
                    <div class="form-group">
                        <label for="urlInput">Website URL</label>
                        <div style="display: flex; gap: 12px; align-items: end;">
                            <input type="url" id="urlInput" class="form-control" placeholder="https://example.com" style="flex: 1;">
                            <input type="number" id="maxPages" class="form-control" value="10" min="1" max="50" 
                                   style="width: 80px;" title="Max pages">
                            <button class="btn" onclick="crawlUrl()" id="crawlBtn">
                                üîç Crawl
                            </button>
                        </div>
                    </div>

                    <div class="loading" id="crawlLoading">
                        <div class="spinner"></div>
                        Crawling website...
                    </div>

                    <div style="margin-top: 20px;">
                        <p><strong>Tips:</strong></p>
                        <ul style="margin-left: 20px; color: 666; font-size: 14px;">
                            <li>Enter the full URL including https://</li>
                            <li>The system will extract text content from web pages</li>
                            <li>Start with a small number of pages for testing</li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- Uploaded Files -->
            <div class="card">
                <h2>üìÇ Uploaded Files</h2>
                <div class="file-list" id="fileList">
                    Loading files...
                </div>
            </div>
        </div>

        <!-- Prompt Editor Tab -->
        <div id="prompt-tab" class="tab-content">
            <div class="card">
                <h2>üìù Edit System Prompt</h2>
                
                <div class="alert alert-success" id="promptSuccess"></div>
                <div class="alert alert-error" id="promptError"></div>
                
                <div class="form-group">
                    <label for="promptEditor">System Prompt Template</label>
                    <textarea id="promptEditor" class="form-control prompt-editor" placeholder="Loading prompt..."></textarea>
                    <small style="color: #666; margin-top: 5px; display: block;">
                        Use {context} for retrieved information and {question} for user input. HTML formatting supported.
                    </small>
                </div>
                
                <div style="display: flex; gap: 12px; flex-wrap: wrap;">
                    <button class="btn" onclick="savePrompt()" id="savePromptBtn">
                        üíæ Save Prompt
                    </button>
                    <button class="btn btn-secondary" onclick="resetPrompt()">
                        üîÑ Reset to Default
                    </button>
                    <button class="btn btn-success" onclick="testPrompt()">
                        üß™ Test in Chat
                    </button>
                </div>

                <div class="loading" id="promptLoading">
                    <div class="spinner"></div>
                    Updating prompt...
                </div>
            </div>
        </div>

        <!-- Widget Integration Tab -->
        <div id="integration-tab" class="tab-content">
            <div class="card">
                <h2>üîå Widget Integration</h2>
                <p>Instructions for integrating the AI chat widget into your website.</p>

                <div class="integration-steps">
                    <div class="integration-step">
                        <div class="integration-step-number"></div>
                        <div class="integration-step-content">
                            <h3>Copy the Integration Code</h3>
                            <p>Add this code snippet just before the closing <code>&lt;/body&gt;</code> tag on all pages where you want the widget to appear.</p>
                            <div class="code-block">
                                <code id="integrationSnippet">&lt;script&gt;
    window.aiChatConfig = {
        websiteId: 'your-website-id',
        position: 'bottom-right',
        theme: 'light',
        greeting: 'Hi! How can I help you today?'
    };
    (function() {
        var d = document, s = d.createElement('script');
        s.src = 'https://your-domain.com/widget.js';
        s.async = 1;
        d.getElementsByTagName('head')[0].appendChild(s);
    })();
&lt;/script&gt;</code>
                            </div>
                            <button class="copy-btn" onclick="copySnippet('integrationSnippet')">
                                üìã Copy Code
                            </button>
                        </div>
                    </div>

                    <div class="integration-step">
                        <div class="integration-step-number"></div>
                        <div class="integration-step-content">
                            <h3>Customize the Widget</h3>
                            <p>You can customize the widget's appearance and behavior by modifying the configuration options:</p>
                            
                            <div class="customization-options">
                                <div class="option-card">
                                    <h4>Position Options</h4>
                                    <pre>position: 'bottom-right' // or 'bottom-left'</pre>
                                </div>
                                <div class="option-card">
                                    <h4>Theme Options</h4>
                                    <pre>theme: 'light' // or 'dark'</pre>
                                </div>
                                <div class="option-card">
                                    <h4>Custom Greeting</h4>
                                    <pre>greeting: 'Your custom message'</pre>
                                </div>
                                <div class="option-card">
                                    <h4>Auto-open</h4>
                                    <pre>autoOpen: false // Set to true to open automatically</pre>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="integration-step">
                        <div class="integration-step-number"></div>
                        <div class="integration-step-content">
                            <h3>Test the Integration</h3>
                            <p>After adding the code to your website, test that the widget appears and functions correctly.</p>
                            
                            <div class="preview-container">
                                <div class="preview-header">
                                    <h4>Widget Preview</h4>
                                    <div class="preview-actions">
                                        <button class="btn btn-secondary" onclick="refreshPreview()">
                                            üîÑ Refresh
                                        </button>
                                        <button class="btn" onclick="openPreview()">
                                            ‚ÜóÔ∏è Open Full Preview
                                        </button>
                                    </div>
                                </div>
                                <div class="preview-window">
                                    <iframe id="previewFrame" src="about:blank" frameborder="0"></iframe>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <h2>‚ùì Frequently Asked Questions</h2>
                    
                    <div class="faq-item">
                        <div class="faq-question">Where do I find my website ID?</div>
                        <div class="faq-answer">Your website ID is shown in the Overview tab and can be copied from there. It's automatically generated when you add a website to the system.</div>
                    </div>
                    
                    <div class="faq-item">
                        <div class="faq-question">Can I customize the widget's colors to match my brand?</div>
                        <div class="faq-answer">Yes, advanced customization is available. Contact support for help with custom CSS integration.</div>
                    </div>
                    
                    <div class="faq-item">
                        <div class="faq-question">Does the widget work on mobile devices?</div>
                        <div class="faq-answer">Yes, the widget is fully responsive and works on all modern mobile browsers.</div>
                    </div>
                    
                    <div class="faq-item">
                        <div class="faq-question">How do I track widget performance?</div>
                        <div class="faq-answer">Conversation metrics and widget analytics are available in the Overview and System Health sections.</div>
                    </div>
                    
                    <div class="faq-item">
                        <div class="faq-question">What if I need to remove the widget?</div>
                        <div class="faq-answer">Simply remove the code snippet from your website. The widget will no longer load on subsequent visits.</div>
                    </div>
                </div>

                <div class="card">
                    <h2>üõ†Ô∏è Advanced Integration</h2>
                    <p>For more complex integration needs, you can use our JavaScript API:</p>
                    
                    <div class="code-block">
                        <code id="apiSnippet">// Programmatically open the chat widget
window.openAIChat();

// Programmatically close the chat widget  
window.closeAIChat();

// Listen for chat events
window.addEventListener('aiChatLoaded', function() {
    console.log('Chat widget loaded');
});

window.addEventListener('aiChatOpened', function() {
    console.log('Chat widget opened');
});

window.addEventListener('aiChatClosed', function() {
    console.log('Chat widget closed');
});</code>
                    </div>
                    <button class="copy-btn" onclick="copySnippet('apiSnippet')">
                        üìã Copy API Examples
                    </button>
                </div>
            </div>
        </div>

        <!-- System Management Tab -->
        <div id="system-tab" class="tab-content">
            <div class="card">
                <h2>üîß System Management</h2>
                
                <div class="alert alert-success" id="systemSuccess"></div>
                <div class="alert alert-error" id="systemError"></div>
                
                <div class="management-grid">
                    <div class="management-item">
                        <h3>Reset Knowledge Base</h3>
                        <p>Clear all uploaded files and AI knowledge. This will remove:</p>
                        <ul>
                            <li>All uploaded documents</li>
                            <li>Vector database</li>
                            <li>Learned conversations</li>
                            <li>Knowledge base content</li>
                        </ul>
                        <button class="btn btn-danger" onclick="resetKnowledgeBase()" id="resetKnowledgeBtn">
                            üóëÔ∏è Reset Knowledge Base
                        </button>
                    </div>
                    
                    <div class="management-item">
                        <h3>Clear Chat Logs</h3>
                        <p>Remove all chat history and conversation logs:</p>
                        <ul>
                            <li>Chat logs database</li>
                            <li>Conversation history</li>
                            <li>User session data</li>
                        </ul>
                        <button class="btn btn-danger" onclick="clearChatLogs()" id="clearLogsBtn">
                            üìù Clear Chat Logs
                        </button>
                    </div>
                    
                    <div class="management-item">
                        <h3>Backup System</h3>
                        <p>Create a backup of all system data:</p>
                        <ul>
                            <li>Vector database</li>
                            <li>Uploaded files</li>
                            <li>Configuration</li>
                            <li>Chat logs</li>
                        </ul>
                        <button class="btn btn-success" onclick="createBackup()" id="backupBtn">
                            üíæ Create Backup
                        </button>
                    </div>

                    <div class="management-item">
                        <h3>Refresh Session</h3>
                        <p>Refresh the chat session without deleting data:</p>
                        <ul>
                            <li>Clear user sessions</li>
                            <li>Reset conversation state</li>
                            <li>Preserve all knowledge</li>
                        </ul>
                        <button class="btn btn-secondary" onclick="refreshSession()" id="refreshBtn">
                            üîÑ Refresh Session
                        </button>
                    </div>
                    
                    <div class="management-item" style="border: 2px solid #dc3545;">
                        <h3>Full System Reset</h3>
                        <p>‚ö†Ô∏è NUCLEAR OPTION: Reset everything to factory settings:</p>
                        <ul>
                            <li>All files and knowledge</li>
                            <li>All chat logs</li>
                            <li>All user data</li>
                            <li>System configuration</li>
                        </ul>
                        <button class="btn btn-danger" onclick="fullSystemReset()" id="fullResetBtn">
                            üíÄ Full System Reset
                        </button>
                    </div>

                    <div class="management-item">
                        <h3>System Information</h3>
                        <p>Current system status and statistics:</p>
                        <div id="systemInfo" style="background: #e9ecef; border-radius: 8px; padding: 15px; margin-top: 10px;">
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 10px;">
                                <div style="text-align: center;">
                                    <strong id="vectorCount">-</strong>
                                    <div style="font-size: 12px; color: #666;">Vector Documents</div>
                                </div>
                                <div style="text-align: center;">
                                    <strong id="fileCount">-</strong>
                                    <div style="font-size: 12px; color: #666;">Uploaded Files</div>
                                </div>
                                <div style="text-align: center;">
                                    <strong id="chatLogCount">-</strong>
                                    <div style="font-size: 12px; color: #666;">Chat Logs</div>
                                </div>
                                <div style="text-align: center;">
                                    <strong id="backupCount">-</strong>
                                    <div style="font-size: 12px; color: #666;">Backups</div>
                                </div>
                            </div>
                            <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid #ced4da; text-align: center;">
                                <strong>Website ID:</strong> <span id="websiteIdDisplay">-</span>
                                <button class="copy-btn" onclick="copyWebsiteId()" style="margin-left: 10px;">
                                    üìã Copy ID
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="loading" id="systemLoading">
                    <div class="spinner"></div>
                    Processing system operation...
                </div>
            </div>
        </div>

        <!-- Footer -->
        <footer style="background: white; border-radius: 12px; padding: 25px; box-shadow: 0 4px 20px rgba(0,0,0,0.08); border: 1px solid #e1e5e9; margin-top: 25px;">
          <div style="text-align: center;">
            <p style="margin-bottom: 0.75rem; font-size: 0.875rem; color: #666;">&copy; 2025 <strong style="color: #667eea;">Jan Francis Israel</strong>. All rights reserved.</p>
            <div style="display: flex; align-items: center; justify-content: center; gap: 0.5rem; flex-wrap: wrap; margin-top: 0.5rem;">
              <a href="https://janisrael.com" target="_blank" rel="noopener noreferrer" style="display: inline-flex; align-items: center; gap: 0.35rem; color: #667eea; text-decoration: none; font-size: 0.85rem; padding: 0.25rem 0.5rem; border-radius: 0.25rem; transition: all 0.3s ease;">
                <span class="material-symbols-rounded" style="font-size: 16px;">language</span>
                janisrael.com
              </a>
              <span style="color: #999; font-size: 0.75rem;">|</span>
              <a href="https://huggingface.co/swordfish7412" target="_blank" rel="noopener noreferrer" style="display: inline-flex; align-items: center; gap: 0.35rem; color: #667eea; text-decoration: none; font-size: 0.85rem; padding: 0.25rem 0.5rem; border-radius: 0.25rem; transition: all 0.3s ease;">
                <span class="material-symbols-rounded" style="font-size: 16px;">hub</span>
                HuggingFace
              </a>
              <span style="color: #999; font-size: 0.75rem;">|</span>
              <a href="https://github.com/janisrael" target="_blank" rel="noopener noreferrer" style="display: inline-flex; align-items: center; gap: 0.35rem; color: #667eea; text-decoration: none; font-size: 0.85rem; padding: 0.25rem 0.5rem; border-radius: 0.25rem; transition: all 0.3s ease;">
                <span class="material-symbols-rounded" style="font-size: 16px;">code</span>
                GitHub
              </a>
            </div>
          </div>
        </footer>
    </div>

    <script src="/static/v2/js/dashboard-core.js"></script>
    <script src="/static/v2/js/dashboard-utils.js"></script>
    <script src="/static/v2/js/dashboard-overview.js"></script>
    <script src="/static/v2/js/dashboard-llm.js"></script>
    <script src="/static/v2/js/dashboard-prompt.js"></script>
    <script>
        function updateIntegrationSnippet() {
            const snippetElement = document.getElementById('integrationSnippet');
            if (snippetElement) {
                const websiteName = websites[currentWebsiteId]?.name || currentWebsiteId;
                snippetElement.textContent = `<script>
    window.aiChatConfig = {
        websiteId: '${currentWebsiteId}', // ${websiteName}
        position: 'bottom-right',
        theme: 'light',
        greeting: 'Hi! How can I help you today?'
    };
    (function() {
        var d = document, s = d.createElement('script');
        s.src = 'https://your-domain.com/widget.js';
        s.async = 1;
        d.getElementsByTagName('head')[0].appendChild(s);
    })();
<\/script>`;
            }
        }

        function copySnippet(elementId) {
            const element = document.getElementById(elementId);
            const text = element.textContent || element.innerText;
            
            navigator.clipboard.writeText(text).then(() => {
                // Show temporary success message
                const button = event.target;
                const originalText = button.innerHTML;
                button.innerHTML = '‚úÖ Copied!';
                
                setTimeout(() => {
                    button.innerHTML = originalText;
                }, 2000);
            }).catch(err => {
                console.error('Failed to copy: ', err);
                alert('Failed to copy text. Please try again.');
            });
        }

        function refreshPreview() {
            const iframe = document.getElementById('previewFrame');
            // In a real implementation, this would point to your widget preview endpoint
            iframe.src = 'about:blank';
            setTimeout(() => {
                iframe.src = '/widget-preview';
            }, 100);
        }

        function openPreview() {
            window.open('/widget-preview', '_blank');
        }

        function copyWebsiteId() {
            navigator.clipboard.writeText(currentWebsiteId).then(() => {
                // Show temporary success message
                const button = event.target;
                const originalText = button.innerHTML;
                button.innerHTML = '‚úÖ Copied!';
                
                setTimeout(() => {
                    button.innerHTML = originalText;
                }, 2000);
            }).catch(err => {
                console.error('Failed to copy: ', err);
                alert('Failed to copy website ID. Please try again.');
            });
        }

        // ===========================
        // SYSTEM MANAGEMENT
        // ===========================

        async function resetKnowledgeBase() {
            if (!confirm("‚ö†Ô∏è This will delete ALL uploaded files and AI knowledge. Continue?")) return;
            if (!confirm("üö® FINAL WARNING: This action cannot be undone! Proceed?")) return;
            
            const confirmText = prompt("Type 'RESET KNOWLEDGE' to confirm this action:");
            if (confirmText !== "RESET KNOWLEDGE") {
                alert("Reset cancelled - confirmation phrase did not match.");
                return;
            }

            const resetBtn = document.getElementById('resetKnowledgeBtn');
            const systemLoading = document.getElementById('systemLoading');
            
            if (resetBtn) {
                resetBtn.innerHTML = '‚è≥ Resetting Knowledge...';
                resetBtn.disabled = true;
            }
            if (systemLoading) systemLoading.style.display = 'block';
            
            try {
                // Simulate API call - replace with actual API call
                await new Promise(resolve => setTimeout(resolve, 3000));
                
                showAlert('systemSuccess', 'Knowledge base reset successfully');
                setTimeout(loadStats, 1000);
                
            } catch (error) {
                showAlert('systemError', 'Failed to reset knowledge base: ' + error.message);
            } finally {
                if (resetBtn) {
                    resetBtn.innerHTML = 'üóëÔ∏è Reset Knowledge Base';
                    resetBtn.disabled = false;
                }
                if (systemLoading) systemLoading.style.display = 'none';
            }
        }

        async function clearChatLogs() {
            if (!confirm("‚ö†Ô∏è This will delete ALL chat logs and conversation history. Continue?")) return;
            
            const clearBtn = document.getElementById('clearLogsBtn');
            const systemLoading = document.getElementById('systemLoading');
            
            if (clearBtn) {
                clearBtn.innerHTML = '‚è≥ Clearing Logs...';
                clearBtn.disabled = true;
            }
            if (systemLoading) systemLoading.style.display = 'block';
            
            try {
                // Simulate API call - replace with actual API call
                await new Promise(resolve => setTimeout(resolve, 2000));
                
                showAlert('systemSuccess', 'Chat logs cleared successfully');
                
            } catch (error) {
                showAlert('systemError', 'Failed to clear logs: ' + error.message);
            } finally {
                if (clearBtn) {
                    clearBtn.innerHTML = 'üìù Clear Chat Logs';
                    clearBtn.disabled = false;
                }
                if (systemLoading) systemLoading.style.display = 'none';
            }
        }

        async function createBackup() {
            const backupBtn = document.getElementById('backupBtn');
            const systemLoading = document.getElementById('systemLoading');
            
            if (backupBtn) {
                backupBtn.innerHTML = '‚è≥ Creating Backup...';
                backupBtn.disabled = true;
            }
            if (systemLoading) systemLoading.style.display = 'block';
            
            try {
                // Simulate API call - replace with actual API call
                await new Promise(resolve => setTimeout(resolve, 3000));
                
                showAlert('systemSuccess', `Backup created successfully at /backups/backup-${new Date().toISOString().slice(0, 10)}.zip`);
                
            } catch (error) {
                showAlert('systemError', 'Failed to create backup: ' + error.message);
            } finally {
                if (backupBtn) {
                    backupBtn.innerHTML = 'üíæ Create Backup';
                    backupBtn.disabled = false;
                }
                if (systemLoading) systemLoading.style.display = 'none';
            }
        }

        async function refreshSession() {
            const refreshBtn = document.getElementById('refreshBtn');
            
            if (refreshBtn) {
                refreshBtn.innerHTML = '‚è≥ Refreshing...';
                refreshBtn.disabled = true;
            }
            
            try {
                // Simulate API call - replace with actual API call
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                showAlert('systemSuccess', 'Session refreshed successfully');
                
            } catch (error) {
                showAlert('systemError', 'Failed to refresh session: ' + error.message);
            } finally {
                if (refreshBtn) {
                    refreshBtn.innerHTML = 'üîÑ Refresh Session';
                    refreshBtn.disabled = false;
                }
            }
        }

        async function fullSystemReset() {
            if (!confirm("üíÄ NUCLEAR OPTION: This will delete EVERYTHING. Continue?")) return;
            if (!confirm("üö® ABSOLUTE FINAL WARNING: ALL DATA WILL BE LOST! Proceed?")) return;
            
            const confirmText = prompt("Type 'RESET EVERYTHING' to confirm this action:");
            if (confirmText !== "RESET EVERYTHING") {
                alert("Reset cancelled - confirmation phrase did not match.");
                return;
            }

            const resetBtn = document.getElementById('fullResetBtn');
            const systemLoading = document.getElementById('systemLoading');
            
            if (resetBtn) {
                resetBtn.innerHTML = '‚è≥ Resetting Everything...';
                resetBtn.disabled = true;
            }
            if (systemLoading) systemLoading.style.display = 'block';
            
            try {
                // Simulate API calls - replace with actual API calls
                await new Promise(resolve => setTimeout(resolve, 4000));
                
                showAlert('systemSuccess', 'Full system reset completed successfully!');
                setTimeout(() => {
                    loadStats();
                    loadPrompt();
                }, 2000);
                
            } catch (error) {
                showAlert('systemError', 'Failed to perform full reset: ' + error.message);
            } finally {
                if (resetBtn) {
                    resetBtn.innerHTML = 'üíÄ Full System Reset';
                    resetBtn.disabled = false;
                }
                if (systemLoading) systemLoading.style.display = 'none';
            }
        }

        // ===========================
        // STATISTICS AND UTILITIES
        // ===========================

        async function loadStats() {
            try {
                // Simulate API call - replace with actual API call
                const stats = {
                    total_documents: 42,
                    uploaded_files: [
                        { name: 'company-handbook.pdf', size: 2500000, category: 'Company Details', modified: '2 days ago' },
                        { name: 'product-catalog.docx', size: 1800000, category: 'Product Information', modified: '5 days ago' },
                        { name: 'sales-script.txt', size: 85000, category: 'Sales Training', modified: '1 week ago' }
                    ],
                    llm_model: 'GPT-4o Mini',
                    chat_logs: 128,
                    backups: 3
                };
                
                // Update overview stats
                const totalDocs = document.getElementById('totalDocs');
                const totalFiles = document.getElementById('totalFiles');
                const llmModel = document.getElementById('llmModel');
                const currentWebsite = document.getElementById('currentWebsite');
                
                if (totalDocs) totalDocs.textContent = stats.total_documents || 0;
                if (totalFiles) totalFiles.textContent = stats.uploaded_files?.length || 0;
                if (llmModel) llmModel.textContent = stats.llm_model || 'Unknown';
                if (currentWebsite) currentWebsite.textContent = websites[currentWebsiteId]?.name || currentWebsiteId;
                
                // Update system management stats
                const vectorCount = document.getElementById('vectorCount');
                const fileCount = document.getElementById('fileCount');
                const chatLogCount = document.getElementById('chatLogCount');
                const backupCount = document.getElementById('backupCount');
                const websiteIdDisplay = document.getElementById('websiteIdDisplay');
                
                if (vectorCount) vectorCount.textContent = stats.total_documents || 0;
                if (fileCount) fileCount.textContent = stats.uploaded_files?.length || 0;
                if (chatLogCount) chatLogCount.textContent = stats.chat_logs || 0;
                if (backupCount) backupCount.textContent = stats.backups || 0;
                if (websiteIdDisplay) websiteIdDisplay.textContent = currentWebsiteId;
                
                updateFileList(stats.uploaded_files || []);
            } catch (error) {
                console.error('Failed to load stats:', error);
            }
        }

        function updateFileList(files) {
            const fileLists = ['fileList', 'overviewFileList'];
            
            fileLists.forEach(listId => {
                const fileList = document.getElementById(listId);
                if (!fileList) return;
                
                if (files.length === 0) {
                    fileList.innerHTML = '<p style="text-align: center; color: #666; padding: 20px;">No files uploaded yet</p>';
                    return;
                }
                
                fileList.innerHTML = files.map(file => `
                    <div class="file-item">
                        <div class="file-info">
                            <div class="file-name">${file.name}</div>
                            <div class="file-size">${formatFileSize(file.size)} ‚Ä¢ ${file.category || 'Unknown'} ‚Ä¢ ${file.modified}</div>
                        </div>
                    </div>
                `).join('');
            });
        }

        // Initialize utility features (auto-refresh, keyboard shortcuts)
        initializeUtils();
    </script>
    </script>
    </script>
</body>
</html>
