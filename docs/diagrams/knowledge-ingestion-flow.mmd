graph TD
    Start[User Uploads File/Crawls URL/Creates FAQ] --> Type{Knowledge Type?}
    
    Type -->|File| FileUpload[File Upload]
    Type -->|URL| URLCrawl[URL Crawl]
    Type -->|FAQ| FAQCreate[FAQ Creation]
    
    FileUpload --> ExtractText[Extract Text<br/>PDF/DOCX/TXT/CSV]
    URLCrawl --> CrawlPage[Crawl Web Page<br/>Extract Clean Text]
    FAQCreate --> StoreFAQ[Store FAQ<br/>Question + Answer]
    
    ExtractText --> StoreFile[Store File Metadata<br/>filename, text, word_count]
    CrawlPage --> StoreCrawl[Store Crawl Metadata<br/>url, title, text]
    
    StoreFile --> SplitFile[Split Text into Chunks<br/>1000 chars, 200 overlap]
    StoreCrawl --> SplitCrawl[Split Text into Chunks<br/>1000 chars, 200 overlap]
    StoreFAQ --> FormatFAQ[Format FAQ<br/>Q: question\n\nA: answer]
    
    SplitFile --> CreateDocs[Create Document Objects<br/>with metadata]
    SplitCrawl --> CreateDocs
    FormatFAQ --> CreateDocs
    
    CreateDocs --> Embed[Generate Embeddings<br/>HuggingFace all-MiniLM-L6-v2]
    
    Embed --> StoreVector[Store in ChromaDB<br/>user_{id} collection]
    
    StoreVector --> UpdateStatus[Update Status<br/>preview â†’ ingested]
    
    UpdateStatus --> Complete[Ingestion Complete]
    
    style Start fill:#4a90e2,stroke:#2c5aa0,color:#fff
    style ExtractText fill:#7b68ee,stroke:#5a4fcf,color:#fff
    style Embed fill:#50c878,stroke:#3a9d5f,color:#fff
    style StoreVector fill:#ff6b6b,stroke:#d63031,color:#fff
    style Complete fill:#4a90e2,stroke:#2c5aa0,color:#fff
